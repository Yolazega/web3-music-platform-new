services:
  - type: web
    name: web3-music-backend
    runtime: node
    plan: starter
    rootDir: ./backend
    buildCommand: "yarn install && yarn build"
    startCommand: "yarn start"
    healthCheckPath: /
    envVars:
      - key: NODE_VERSION
        value: 18.17.1
      - key: DATABASE_URL
        value: "file:/var/data/db.json"
    disk:
      name: data
      mountPath: /var/data
      sizeGB: 1
  - type: web
    name: web3-music-frontend
    runtime: docker
    plan: starter
    dockerfilePath: ./Dockerfile
    envVars:
      - key: OAUTH2_PROXY_HTTP_ADDRESS
        value: "0.0.0.0:4180"
      - key: OAUTH2_PROXY_UPSTREAMS
        value: "file:///var/www/html#/"
      - key: OAUTH2_PROXY_COOKIE_NAME
        value: "_oauth2_proxy"
      - key: OAUTH2_PROXY_COOKIE_SECURE
        value: "true"
      - key: OAUTH2_PROXY_COOKIE_HTTPONLY
        value: "true"
      - key: OAUTH2_PROXY_COOKIE_SAMESITE
        value: "lax"
      - key: OAUTH2_PROXY_PROVIDER
        value: "github"
      - key: OAUTH2_PROXY_SCOPE
        value: "user:email"
      - key: OAUTH2_PROXY_EMAIL_DOMAINS
        value: "*"
      - key: OAUTH2_PROXY_AUTHENTICATED_EMAILS_FILE
        value: "/etc/oauth2-proxy/emails.txt"
      - key: OAUTH2_PROXY_SKIP_PROVIDER_BUTTON
        value: "false"
      - key: OAUTH2_PROXY_CLIENT_ID
        fromKey: OAUTH2_PROXY_CLIENT_ID
      - key: OAUTH2_PROXY_CLIENT_SECRET
        fromKey: OAUTH2_PROXY_CLIENT_SECRET
      - key: OAUTH2_PROXY_COOKIE_SECRET
        generateValue: true
 